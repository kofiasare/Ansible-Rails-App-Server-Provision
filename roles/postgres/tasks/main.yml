---
- name: Install Postgres
  apt: >
    package={{ item }}
    state=installed
    force=yes
    update_cache=yes
    cache_valid_time=3600
  when: ansible_os_family == 'Debian'
  with_items:
    - postgresql
    - libpq-dev
    - python-psycopg2
  become: true


- block:
  - name: create postgress app database
    postgresql_db: >
      db='{{ app_name }}_{{ app_env }}'
      state=present

  - name: Create postgres user for app database
    postgresql_user: db='{{ app_name }}_{{ app_env }}' name={{postgres_user}} password={{postgres_password}} priv=ALL

  become: yes
  become_user: postgres